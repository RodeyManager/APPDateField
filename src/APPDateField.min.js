/*! APPDateField v2.1.0 | (c) 2014, 2017 , Author: Rodeyluo@gmaile.com */
(function(){var j=this;var b={fontSize:22,step:40,tpl:'<div class="app-s-main">'+'<div class="app-s-top">'+'<span class="app-s-btnCancel"></span>'+'<span class="app-s-title"></span>'+'<span class="app-s-btnOk"></span>'+"</div>"+'<div class="app-s-center">'+'<ul class="app-s-year-con"></ul>'+'<ul class="app-s-month-con"></ul>'+'<ul class="app-s-date-con"></ul>'+'<div class="app-center-current"></div>'+"</div>"+'<div class="app-s-bottom"></div>'+"</div>"};function k(m){return undefined!=m}var d=function(m){return"function"===typeof m};var g=function(){};var e=Object.prototype.toString;var l=function(n,o,m,p){o=o||{};this.selectElm=$("#"+n.replace(/^#/i,""))[0];this.appWrap=$("#app-s-con");this.loaded=false;this.complete=d(o.complete)?o.complete:d(m)?m:g;this.cancel=d(o.cancel)?o.cancel:d(p)?p:g;this.moveEnd=d(o.moveEnd)?o.moveEnd:g;this.step=b.step;this.valList=[];this.currDate=[];this.opts={year:new Date().getFullYear(),month:new Date().getMonth()+1,date:new Date().getDate(),hours:new Date().getHours(),minutes:new Date().getMinutes(),seconds:new Date().getSeconds(),upYear:"number"===typeof o.upYear?o.upYear:60,downYear:"number"===typeof o.downYear?o.downYear:60,data:o.data,dataShowKey:o.dataShowKey||"value",multiDataSelect:o.multiDataSelect,toValues:o.toValues,title:o.title||"",addClass:o.addClass||"",fontSize:o.fontSize||b.fontSize,cancelTxt:o.cancelTxt||"取消",completeTxt:o.completeTxt||"完成",isCN:k(o.isCN)?o.isCN:true,isCircle:k(o.isCircle)?o.isCircle:true,showYear:k(o.showYear)?o.showYear:true,showMonth:k(o.showMonth)?o.showMonth:true,showDate:k(o.showDate)?o.showDate:true,showTime:o.showTime||false,commer:o.commer||"-"};this._init()};l.prototype.reset=function(){this._init()};l.prototype._init=function(){var m=this._getValue();if(this.opts.data){this.valList=m}else{if(m&&m!==""){this.valList=this.subDefaultDate(m||"")}this.setCurrentTXT(this.valList)}if(!this.appWrap[0]){this.appWrap=$("<div />").attr({"id":"app-s-con","class":"app-s-con"});$("body").append(this.appWrap)}else{this.appWrap.fadeIn(10)}this._load()};l.prototype._load=function(){this._render()};l.prototype._render=function(){var m=this.appWrap.html(b.tpl);this.app_main=m.find(".app-s-main");this.app_title=m.find(".app-s-title");this.app_btnCancel=m.find(".app-s-btnCancel");this.app_btnOk=m.find(".app-s-btnOk");this.app_center_con=m.find(".app-s-center");this.app_y_con=m.find(".app-s-year-con");this.app_m_con=m.find(".app-s-month-con");this.app_d_con=m.find(".app-s-date-con");var n=m.width();this.app_title.html(this.opts.title);this.app_btnCancel.html(this.opts.cancelTxt);this.app_btnOk.html(this.opts.completeTxt);if(this.opts.data){this.app_y_con.css({width:n,left:0});this.app_m_con.css("display","none");this.app_d_con.css("display","none");this.loaded=true;this.createDatas();this._events();return false}this._resize();this.loaded=true;if(this.opts.showTime){this.createHours();this.createMins();this.createSeconds()}else{this.createYear();this.createMonth();this.createDate()}this._events()};l.prototype._resize=function(){var m=this.appWrap.width();this.app_center_con.find("ul").css("width",m/3);if(this.opts.showYear&&this.opts.showMonth&&this.opts.showDate){this.app_y_con.css("left",0);this.app_m_con.css("left",m/3);this.app_d_con.css("left",m/3*2)}else{if(this.opts.showYear&&this.opts.showMonth&&!this.opts.showDate){this.app_center_con.find("ul").css("width",m/2);this.app_y_con.css("left",0);this.app_m_con.css("left",m/2);this.app_d_con.css({left:m/2*2,display:"none"})}else{if(!this.opts.showYear&&this.opts.showMonth&&this.opts.showDate){this.app_center_con.find("ul").css("width",m/2);this.app_y_con.css({left:0,display:"none"});this.app_m_con.css("left",0);this.app_d_con.css("left",m/2)}}}};l.prototype.createDatas=function(){var r=this.opts.data;var q=[],v="",s=1,p=0;if(!this.loaded){return}if("[object Object]"===e.call(r)){for(var u in r){v='<li style="font-size:'+this.opts.fontSize+'px;" data-key="'+u+'">'+r[u]+"</li>";q.push(v);if(this.valList===r[u]){s=p+1}p++}this.app_y_con.html(q.join("")).show();var t=this.step*parseInt(s)-(this.step*4);this._scrollTop(this.app_y_con,-t,true)}else{if("[object Array]"===e.call(r)){if(this.opts.multiDataSelect){var n=r[0],o=r[1],m=r[2];if(n){this.opts.showYear=true;this._createHTML(n,this.app_y_con,0)}if(o){this.showMonth=true;this._createHTML(o,this.app_m_con,1)}if(m){this.showDate=true;this._createHTML(m,this.app_d_con,2)}this._resize()}else{this._createHTML(r,this.app_y_con,0)}}else{throw new ReferenceError("data parameter must be an array or object")}}};l.prototype._createHTML=function(s,m,o){var r=[],x="",t=1,q=0;for(var u=s.length;q<u;q++){var p=s[q];if("[object Object]"===e.call(p)){var w="";for(var n in p){if(p.hasOwnProperty(n)){w+=" data-"+n+'="'+p[n]+'"'}}w+='data-adf-index="'+q+'"';x='<li style="font-size:'+this.opts.fontSize+'px;" '+w+">"+p[this.opts.dataShowKey]+"</li>"}else{x='<li style="font-size:'+this.opts.fontSize+'px;">'+s[q]+"</li>"}r.push(x);if(this.valList[o]===s[q]){t=q+1}}m.html(r.join("")).show();
    var v=this.step*parseInt(t)-(this.step*4);this._scrollTop(m,-v,true)};l.prototype.createYear=function(q,u){if(!this.loaded){return}q=q||this.opts.upYear;u=u||this.opts.downYear;var n=new Date(),r=n.getFullYear(),s=[],v="",m="";for(var o=1;o<q+1;o++){v=this.opts.isCN?"<li"+m+">"+(r-o)+"年</li>":"<li>"+(r-o)+"</li>";s.unshift(v)}for(var p=0;p<=u;p++){v=this.opts.isCN?"<li"+m+">"+(r+p)+"年</li>":"<li>"+this.dateFm((r+p))+"</li>";s.push(v)}this.app_y_con.html(s.join(""));var t=this.step*(this.opts.year-parseInt(this.app_y_con.find("li").eq(0).text())-3);this._scrollTop(this.app_y_con,-t)};l.prototype.createMonth=function(){this._createLists(this.app_m_con,1,13,this.opts.month);var m=this.step*parseInt(this.opts.month)-(this.step*4);this._scrollTop(this.app_m_con,-m)};l.prototype.createDate=function(o){var s=0,t=31,n=[1,3,5,7,8,10,12],q=[4,6,9,11],r=this.opts.month,p=[],m="";if(!this.loaded){return}if(n.indexOf(r)!==-1){t=31}else{if(q.indexOf(r)!==-1){t=30}else{if(r===2){t=(((this.opts.year%4===0)&&(this.opts.year%100!==0))||(this.opts.year%400===0))?29:28}}}while(s<t){m=this.opts.isCN?"<li>"+(s+1)+"日</li>":"<li>"+this.dateFm((s+1))+"</li>";p.push(m);s++}this.app_d_con.html(p.join(""));this._scrollTop(this.app_d_con,-(this.step*parseInt(this.opts.date)-(this.step*4)),o)};l.prototype.createHours=function(){this._createLists(this.app_y_con,0,24,this.opts.hours);var m=this.step*(this.opts.hours-parseInt(this.app_y_con.find("li").eq(0).text())-3);this._scrollTop(this.app_y_con,-m)};l.prototype.createMins=function(){this._createLists(this.app_m_con,0,60,this.opts.minutes);var m=this.step*parseInt(this.opts.minutes+1)-(this.step*4);this._scrollTop(this.app_m_con,-m)};l.prototype.createSeconds=function(){this._createLists(this.app_d_con,0,60,this.opts.minutes);var m=this.step*parseInt(this.opts.seconds+1)-(this.step*4);this._scrollTop(this.app_d_con,-m)};l.prototype._createLists=function(p,t,n,r){if(!this.loaded){return}var o=[],m="",q=this.opts.isCN,s="";switch(r){case this.opts.month:s="月";break;case this.opts.date:s="日";break;case this.opts.hours:s="时";break;case this.opts.minutes:s="分";break;case this.opts.secondes:s="秒";break}while(t<n){m=q?"<li>"+t+s+"</li>":"<li>"+this.dateFm(t)+"</li>";o.push(m);t++}p.html(o.join(""))};l.prototype.getYear=function(){return this._getText(this.app_y_con)};l.prototype.getMonth=function(){return this._getText(this.app_m_con)};l.prototype.getDate=function(){return this._getText(this.app_d_con)};l.prototype._getText=function(m){var n=parseInt(this.getCurrChangeElm(m).text());switch(m){case this.app_y_con:this[this.opts.showTime?"hours":"year"]=n;break;case this.app_m_con:this[this.opts.showTime?"minutes":"month"]=n;break;case this.app_d_con:this[this.opts.showTime?"seconds":"date"]=n;break}return n};l.prototype.getCurrChangeElm=function(o){var m,n=Math.round(o.position().top)/this.step;if(n==0){n=3}else{if(n>=1&&n<=3){if(n==1){n=2}else{if(n==2){n=1}else{if(n==3){n=0}}}}else{if(n<0){n=Math.abs(n)+3}}}m=o.find("li").eq(n);return m};l.prototype.setCurrentTXT=function(q){var w=this;var p=q,m=w.opts;if(w.opts.data){this._setValue("function"===typeof this.opts.toValues?this.opts.toValues(q):q.join(",").replace(/,*$/g,""));return this}if(!p||!q.length||p.length===0){this._setValue("");return this}var t=parseInt(p[0]),x=parseInt(p[1]),n=parseInt(p[2]);if(m.showTime){m.hours=t||m.hours;m.minutes=x||m.minutes;m.seconds=n||m.seconds}else{if(!m.showYear){p[0]=""}if(!m.showDate){p[2]=""}m.year=t||m.year;m.month=x||m.month;m.date=n||m.date}var o,v,s,u;if(m.showTime){o=r(m.hours,"时",":")+r(m.minutes,"分",":")+r(m.seconds,"分","")}else{v=r(m.year,"年",m.commer);s=r(m.month,"月",m.commer);u=r(m.date,"日","");if(m.showYear&&m.showMonth&&!m.showDate){o=v+s.replace(m.commer,"")}else{if(!m.showYear&&m.showMonth&&m.showDate){o=s+u}else{o=v+s+u}}}function r(A,z,y){return m.isCN?(A+z):(w.dateFm(A)+y)}this._setValue(o)};l.prototype._setValue=function(m){if(/INPUT/gi.test(this.selectElm.tagName)){this.selectElm.value=m}else{this.selectElm.innerHTML=m}};l.prototype._getValue=function(){if(this.opts.defaultValue){return this.opts.defaultValue}if(/INPUT/gi.test(this.selectElm.tagName)){return this.selectElm.value}else{return this.selectElm.innerHTML}};l.prototype.subDefaultDate=function(p){var m=this,q=[],o=m.opts;if(!p){var n=new Date();if(o.showTime){q.push(n.getHours());q.push(n.getMinutes());q.push(n.getSeconds())}else{q.push(n.getFullYear());q.push(n.getMonth()+1);q.push(n.getDate())}}else{if(o.isCN){q=p.match(/(\d)+/gi)}else{q=p.match(/(\d)+/gi)||p.split(o.commer||"-")}}if(q.length===3){if(!o.showYear){q[0]=""}if(!o.showDate){q[2]=""}}else{if(!o.showYear){q.unshift("")}if(!o.showDate){q.push("")}}m.valList=q;return q};l.prototype.getCurrentDate=function(q,n,p){if(this.opts.data){return this.currDate}var o=this.currDate;o[0]=q||o[0];o[1]=n||o[1];o[2]=p||o[2];this.currDate=o;return o};l.prototype._scrollTop=function(m,n){h(m[0],n,true,this,false);(this.opts.isCircle===true)&&a(m,n,this)};l.prototype._events=function(){var q=this.opts,p=this.app_y_con,m=this.app_m_con,n=this.app_d_con,o=this.app_main;
    (this.opts.showYear||this.opts.showTime)&&new f(p[0],o[0],q,this);(this.opts.showMonth||this.opts.showTime)&&new f(m[0],o[0],q,this);(this.opts.showDate||this.opts.showTime)&&new f(n[0],o[0],q,this);this.app_btnOk.on("touchend",c(this,this._complete));this.app_btnCancel.on("touchend",c(this,this._cancel));this.app_btnOk.on("touchstart",this.endEvent);this.app_btnCancel.on("touchstart",this.endEvent)};l.prototype.endEvent=function(m){m.preventDefault();m.stopPropagation()};l.prototype._complete=function(n){var m;if(this.opts.data){var p=this.getCurrChangeElm(this.app_y_con);var q=this.getCurrChangeElm(this.app_m_con);var o=this.getCurrChangeElm(this.app_d_con);m=[p.text(),q.text(),o.text()];this.changeElement=[p[0],q[0],o[0]]}else{m=[];m.push(this.getYear());m.push(this.getMonth());m.push(this.getDate())}this.currDate=m;this.setCurrentTXT(m);this._hide();this.complete.call(this,n)};l.prototype._cancel=function(m){this._hide()};l.prototype._hide=function(){this.appWrap.css("display","none")};l.prototype.dateFm=function(m){return(m<10)?"0"+m:m};j.APPDateField=l;var f=function(o,m,n,p){this.elm=o;this.elmParent=m;this.hasTouch="ontouchstart" in window||window.TouchEvent;this.isTouchStart=false;this.options=n;this.callTarget=p;this.vlist={year:this.options.year,month:this.options.month,date:this.options.date,hours:this.options.hours,minutes:this.options.minutes,seconds:this.options.seconds};this.dy=0;this.h=$(this.elm).height();this.moveY=0;this.top=$(this.elm).position().top;this.step=b.step;this.fontSize=this.callTarget.opts.fontSize;this.offset={left:this.elmParent.offsetLeft,top:this.elmParent.offsetTop,width:$(this.elmParent).width(),height:$(this.elmParent).height()};this.startTime=0;this._initEvent(o)};f.prototype={_initEvent:function(m){if(this.hasTouch){this.elmParent.addEventListener("touchstart",this,false);m.addEventListener("touchmove",this,false);m.addEventListener("touchend",this,false)}else{this.elmParent.addEventListener("mousedown",this,false);m.addEventListener("mousemove",this,false);m.addEventListener("mouseup",this,false)}},handleEvent:function(m){switch(m.type){case"touchstart":this._start(m.targetTouches[0],m);break;case"touchmove":this._move(m.changedTouches[0],m);break;case"touchend":this._end(m.changedTouches[0],m);break;case"mousedown":this._start(m);break;case"mousemove":this._move(m);break;case"mouseup":this._end(m);break}if(/SELECT|TEXTAREA|INPUT/.test(m.target.tagName.toUpperCase())){m.preventDefault()}m.preventDefault();m.stopPropagation()},_start:function(m){this.isTouchStart=true;this.y=this.top=$(this.elm).position().top;this.h=$(this.elm).height();this.moveY=m.pageY;this.startTime=Date.now()},_move:function(m){if(this.isTouchStart){var o=$(m.target).parent("ul");o.find("li").css("fontSize",this.fontSize+"px");this.dy=this.y-(this.moveY-m.pageY);var n=this._formateTop(this.dy);this._scrollTop(o[0],n,true);(this.callTarget.opts.isCircle===true)&&a(o,n,this.callTarget)}},_end:function(m){this.isTouchStart=false;var p=$(m.target).parent("ul");var q=m.pageY-this.moveY;var n=this.y+q;var o=this._formateTop(n);this._scrollTop(p[0],o,false);(this.callTarget.opts.isCircle===true)&&a(p,o,this.callTarget)},_formateTop:function(m){if(m>=(b.step*3)){m=(b.step*3)}else{if(Math.abs(m)>=this.h-(b.step*4)){m=-(this.h-(b.step*4))}else{return m}}this.y=m;return m},_scrollTop:function(n,o,m){h(n,o,m,this,!this.callTarget.opts.showTime)}};function c(p,o){var m=[];for(var n=2;n<arguments.length;n++){m.push(arguments[n])}return function(q){m.push(q);o.call(p,q,m)}}function h(o,t,m,q,s){if(!o){return false}t=t||0;var p=b.step,r=q instanceof f;if(m){o.style.top=t+"px";s&&i(o,q)}else{$(o).off().animate({top:t},10,function(){var u=t%p;if(u!==0){var v=p*Math.round(t/p)-(Math.abs(u)<p?0:p);$(this).animate({top:v},function(){s&&i(o,q);n()});q.y=v}else{n()}})}function n(){if(!r){return}q.callTarget.moveElment=q.elm;var u=q.callTarget.getCurrChangeElm($(o));q.callTarget.moveEnd.call(q.callTarget,u[0],o)}}function i(m,n){if(!n.isTouchStart&&!n.callTarget.opts.data){n.callTarget.opts.year=n.callTarget.getYear();n.callTarget.opts.month=n.callTarget.getMonth();if(!$(m).hasClass("app-s-date-con")){n.callTarget.createDate(false)}}}function a(n,t,s){var o=Math.round(t/b.step);var q=Math.round(n.height()/b.step);if(o>=q){o=q-1}else{if(o>=1&&o<=3){if(o==1){o=3-o}else{if(o==2){o=3-o}else{if(o==3){o=0}}}}else{if(o<=0){o=Math.abs(o)+3}}}var p=s.app_center_con.find("ul").filter(function(u){return $(this).css("display")!="none"}),r=p.length;$.each(n.find("li"),function(u,v){if(o-4>u||u>o+4){$(v).css("visibility","hidden")}else{$(v).attr("style","")}});m("up");m("down");function m(A){var w=0,z=4,C,B,y=s.opts.fontSize,v=0,F=5,D=0,x=10;for(;w<z;w++){B="up"===A?o-w:o+w;C=(n.find("li").eq(B))[0];if(!C){continue}if(r===3){C.style.cssText="font-size:"+y+"px; text-indent:"+v+"px; -webkit-transform: skewX("+D+"deg)";n.hasClass("app-s-year-con")&&E();n.hasClass("app-s-date-con")&&u()}else{C.style.fontSize=y+"px"}y-=4}function E(){v+=F;
    (A==="down")?(D+=x):(D-=x)}function u(){v-=F;(A==="down")?(D-=x):(D+=x)}}}}).call(this);