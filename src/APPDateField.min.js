/*! APPDateField v2.1.0 | (c) 2014, 2017 , Author: Rodeyluo@gmaile.com */
(function(){var k=this;var b={fontSize:22,step:40,tpl:'<div class="app-s-main">'+'<div class="app-s-top">'+'<span class="app-s-btnCancel"></span>'+'<span class="app-s-title"></span>'+'<span class="app-s-btnOk"></span>'+"</div>"+'<div class="app-s-center">'+'<ul class="app-s-year-con"></ul>'+'<ul class="app-s-month-con"></ul>'+'<ul class="app-s-date-con"></ul>'+'<div class="app-center-current"></div>'+"</div>"+'<div class="app-s-bottom"></div>'+"</div>"};function l(n){return undefined!==n}var d=function(n){return"function"===typeof n};var h=function(){};function g(){}var e=Object.prototype.toString;var m=function(o,p,n,q){p=p||{};this.selectElm=$("#"+o.replace(/^#/i,""))[0];this.appWrap=$("#app-s-con");this.loaded=false;this.complete=d(p.complete)?p.complete:d(n)?n:h;this.cancel=d(p.cancel)?p.cancel:d(q)?q:h;this.moveEnd=d(p.moveEnd)?p.moveEnd:h;if((p.complete&&l(p.complete)&&typeof p.complete==="function")||(n&&typeof n==="function")){this.complete=p.complete||n||g}if((p.cancel&&l(p.cancel)&&typeof p.cancel==="function")||(q&&typeof q==="function")){this.cancel=p.cancel||q||g}this.step=b.step;this.valList=[];this.currDate=[];this.opts={year:new Date().getFullYear(),month:new Date().getMonth()+1,date:new Date().getDate(),hours:new Date().getHours(),minutes:new Date().getMinutes(),seconds:new Date().getSeconds(),upYear:"number"===typeof p.upYear?p.upYear:60,downYear:"number"===typeof p.downYear?p.downYear:60,data:p.data,dataShowKey:p.dataShowKey||"value",multiDataSelect:p.multiDataSelect,toValues:p.toValues,title:p.title||"",addClass:p.addClass||"",fontSize:p.fontSize||b.fontSize,cancelTxt:p.cancelTxt||"取消",completeTxt:p.completeTxt||"完成",isCN:l(p.isCN)?p.isCN:true,isCircle:l(p.isCircle)?p.isCircle:true,showYear:l(p.showYear)?p.showYear:true,showMonth:l(p.showMonth)?p.showMonth:true,showDate:l(p.showDate)?p.showDate:true,showTime:p.showTime||false,commer:p.commer||"-"};this._init()};m.prototype.reset=function(){this._init()};m.prototype._init=function(){var n=this._getValue();if(this.opts.data){this.valList=n}else{if(n&&n!==""){this.valList=this.subDefaultDate(n||"")}this.setCurrentTXT(this.valList)}if(!this.appWrap[0]){this.appWrap=$("<div />").attr({"id":"app-s-con","class":"app-s-con"});$("body").append(this.appWrap)}else{this.appWrap.fadeIn(10)}this._load()};m.prototype._load=function(){this._render()};m.prototype._render=function(){var n=this.appWrap.html(b.tpl);this.app_main=n.find(".app-s-main");this.app_title=n.find(".app-s-title");this.app_btnCancel=n.find(".app-s-btnCancel");this.app_btnOk=n.find(".app-s-btnOk");this.app_center_con=n.find(".app-s-center");this.app_y_con=n.find(".app-s-year-con");this.app_m_con=n.find(".app-s-month-con");this.app_d_con=n.find(".app-s-date-con");var o=n.width();this.app_title.html(this.opts.title);this.app_btnCancel.html(this.opts.cancelTxt);this.app_btnOk.html(this.opts.completeTxt);if(this.opts.data){this.app_y_con.css({width:o,left:0});this.app_m_con.css("display","none");this.app_d_con.css("display","none");this.loaded=true;this.createDatas();this._events();return false}this._resize();this.loaded=true;if(this.opts.showTime){this.createHours();this.createMins();this.createSeconds()}else{this.createYear();this.createMonth();this.createDate()}this._events()};m.prototype._resize=function(){var n=this.appWrap.width();this.app_center_con.find("ul").css("width",n/3);if(this.opts.showYear&&this.opts.showMonth&&this.opts.showDate){this.app_y_con.css("left",0);this.app_m_con.css("left",n/3);this.app_d_con.css("left",n/3*2)}else{if(this.opts.showYear&&this.opts.showMonth&&!this.opts.showDate){this.app_center_con.find("ul").css("width",n/2);this.app_y_con.css("left",0);this.app_m_con.css("left",n/2);this.app_d_con.css({left:n/2*2,display:"none"})}else{if(!this.opts.showYear&&this.opts.showMonth&&this.opts.showDate){this.app_center_con.find("ul").css("width",n/2);this.app_y_con.css({left:0,display:"none"});this.app_m_con.css("left",0);this.app_d_con.css("left",n/2)}}}};m.prototype.createDatas=function(){var s=this.opts.data;var r=[],w="",t=1,q=0;if(!this.loaded){return}if("[object Object]"===e.call(s)){for(var v in s){w='<li style="font-size:'+this.opts.fontSize+'px;" data-key="'+v+'">'+s[v]+"</li>";r.push(w);if(this.valList===s[v]){t=q+1}q++}this.app_y_con.html(r.join("")).show();var u=this.step*parseInt(t)-(this.step*4);this._scrollTop(this.app_y_con,-u,true)}else{if("[object Array]"===e.call(s)){if(this.opts.multiDataSelect){var o=s[0],p=s[1],n=s[2];if(o){this.opts.showYear=true;this._createHTML(o,this.app_y_con,0)}if(p){this.showMonth=true;this._createHTML(p,this.app_m_con,1)}if(n){this.showDate=true;this._createHTML(n,this.app_d_con,2)}this._resize()}else{this._createHTML(s,this.app_y_con,0)}}else{throw new ReferenceError("data parameter must be an array or object")}}};m.prototype._createHTML=function(t,n,p){var s=[],y="",u=1,r=0;for(var v=t.length;r<v;r++){var q=t[r];if("[object Object]"===e.call(q)){var x="";for(var o in q){if(q.hasOwnProperty(o)){x+=" data-"+o+'="'+q[o]+'"'
}}x+='data-adf-index="'+r+'"';y='<li style="font-size:'+this.opts.fontSize+'px;" '+x+">"+q[this.opts.dataShowKey]+"</li>"}else{y='<li style="font-size:'+this.opts.fontSize+'px;">'+t[r]+"</li>"}s.push(y);if(this.valList[p]===t[r]){u=r+1}}n.html(s.join("")).show();var w=this.step*parseInt(u)-(this.step*4);this._scrollTop(n,-w,true)};m.prototype.createYear=function(r,v){if(!this.loaded){return}r=r||this.opts.upYear;v=v||this.opts.downYear;var o=new Date(),s=o.getFullYear(),t=[],w="",n="";for(var p=1;p<r+1;p++){w=this.opts.isCN?"<li"+n+">"+(s-p)+"年</li>":"<li>"+(s-p)+"</li>";t.unshift(w)}for(var q=0;q<=v;q++){w=this.opts.isCN?"<li"+n+">"+(s+q)+"年</li>":"<li>"+this.dateFm((s+q))+"</li>";t.push(w)}this.app_y_con.html(t.join(""));var u=this.step*(this.opts.year-parseInt(this.app_y_con.find("li").eq(0).text())-3);this._scrollTop(this.app_y_con,-u)};m.prototype.createMonth=function(){this._createLists(this.app_m_con,1,13,this.opts.month);var n=this.step*parseInt(this.opts.month)-(this.step*4);this._scrollTop(this.app_m_con,-n)};m.prototype.createDate=function(p){var t=0,u=31,o=[1,3,5,7,8,10,12],r=[4,6,9,11],s=this.opts.month,q=[],n="";if(!this.loaded){return}if(o.indexOf(s)!==-1){u=31}else{if(r.indexOf(s)!==-1){u=30}else{if(s===2){u=(((this.opts.year%4===0)&&(this.opts.year%100!==0))||(this.opts.year%400===0))?29:28}}}while(t<u){n=this.opts.isCN?"<li>"+(t+1)+"日</li>":"<li>"+this.dateFm((t+1))+"</li>";q.push(n);t++}this.app_d_con.html(q.join(""));this._scrollTop(this.app_d_con,-(this.step*parseInt(this.opts.date)-(this.step*4)),p)};m.prototype.createHours=function(){this._createLists(this.app_y_con,0,24,this.opts.hours);var n=this.step*(this.opts.hours-parseInt(this.app_y_con.find("li").eq(0).text())-3);this._scrollTop(this.app_y_con,-n)};m.prototype.createMins=function(){this._createLists(this.app_m_con,0,60,this.opts.minutes);var n=this.step*parseInt(this.opts.minutes+1)-(this.step*4);this._scrollTop(this.app_m_con,-n)};m.prototype.createSeconds=function(){this._createLists(this.app_d_con,0,60,this.opts.minutes);var n=this.step*parseInt(this.opts.seconds+1)-(this.step*4);this._scrollTop(this.app_d_con,-n)};m.prototype._createLists=function(q,u,o,s){if(!this.loaded){return}var p=[],n="",r=this.opts.isCN,t="";switch(s){case this.opts.month:t="月";break;case this.opts.date:t="日";break;case this.opts.hours:t="时";break;case this.opts.minutes:t="分";break;case this.opts.secondes:t="秒";break}while(u<o){n=r?"<li>"+u+t+"</li>":"<li>"+this.dateFm(u)+"</li>";p.push(n);u++}q.html(p.join(""))};m.prototype.getYear=function(){return this._getText(this.app_y_con)};m.prototype.getMonth=function(){return this._getText(this.app_m_con)};m.prototype.getDate=function(){return this._getText(this.app_d_con)};m.prototype._getText=function(n){var o=parseInt(this.getCurrChangeElm(n).text());switch(n){case this.app_y_con:this[this.opts.showTime?"hours":"year"]=o;break;case this.app_m_con:this[this.opts.showTime?"minutes":"month"]=o;break;case this.app_d_con:this[this.opts.showTime?"seconds":"date"]=o;break}return o};m.prototype.getCurrChangeElm=function(p){var n,o=Math.round(p.position().top)/this.step;if(o==0){o=3}else{if(o>=1&&o<=3){if(o==1){o=2}else{if(o==2){o=1}else{if(o==3){o=0}}}}else{if(o<0){o=Math.abs(o)+3}}}n=p.find("li").eq(o);return n};m.prototype.setCurrentTXT=function(r){var x=this;var q=r,n=x.opts;if(x.opts.data){this._setValue("function"===typeof this.opts.toValues?this.opts.toValues(r):r.join(",").replace(/,*$/g,""));return this}if(!q||!r.length||q.length===0){this._setValue("");return this}var u=parseInt(q[0]),y=parseInt(q[1]),o=parseInt(q[2]);if(n.showTime){n.hours=u||n.hours;n.minutes=y||n.minutes;n.seconds=o||n.seconds}else{if(!n.showYear){q[0]=""}if(!n.showDate){q[2]=""}n.year=u||n.year;n.month=y||n.month;n.date=o||n.date}var p,w,t,v;if(n.showTime){p=s(n.hours,"时",":")+s(n.minutes,"分",":")+s(n.seconds,"分","")}else{w=s(n.year,"年",n.commer);t=s(n.month,"月",n.commer);v=s(n.date,"日","");if(n.showYear&&n.showMonth&&!n.showDate){p=w+t.replace(n.commer,"")}else{if(!n.showYear&&n.showMonth&&n.showDate){p=t+v}else{p=w+t+v}}}function s(B,A,z){return n.isCN?(B+A):(x.dateFm(B)+z)}this._setValue(p)};m.prototype._setValue=function(n){if(/INPUT/gi.test(this.selectElm.tagName)){this.selectElm.value=n}else{this.selectElm.innerHTML=n}};m.prototype._getValue=function(){if(this.opts.defaultValue){return this.opts.defaultValue}if(/INPUT/gi.test(this.selectElm.tagName)){return this.selectElm.value}else{return this.selectElm.innerHTML}};m.prototype.subDefaultDate=function(q){var n=this,r=[],p=n.opts;if(!q){var o=new Date();if(p.showTime){r.push(o.getHours());r.push(o.getMinutes());r.push(o.getSeconds())}else{r.push(o.getFullYear());r.push(o.getMonth()+1);r.push(o.getDate())}}else{if(p.isCN){r=q.match(/(\d)+/gi)}else{r=q.match(/(\d)+/gi)||q.split(p.commer||"-")}}if(r.length===3){if(!p.showYear){r[0]=""}if(!p.showDate){r[2]=""}}else{if(!p.showYear){r.unshift("")}if(!p.showDate){r.push("")}}n.valList=r;return r};m.prototype.getCurrentDate=function(q,n,p){if(this.opts.data){return this.currDate
}var o=this.currDate;o[0]=q||o[0];o[1]=n||o[1];o[2]=p||o[2];this.currDate=o;return o};m.prototype._scrollTop=function(n,o){i(n[0],o,true,this,false);(this.opts.isCircle===true)&&a(n,o,this)};m.prototype._events=function(){var r=this.opts,q=this.app_y_con,n=this.app_m_con,o=this.app_d_con,p=this.app_main;(this.opts.showYear||this.opts.showTime)&&new f(q[0],p[0],r,this);(this.opts.showMonth||this.opts.showTime)&&new f(n[0],p[0],r,this);(this.opts.showDate||this.opts.showTime)&&new f(o[0],p[0],r,this);this.app_btnOk.on("touchend",c(this,this._complete));this.app_btnCancel.on("touchend",c(this,this._cancel));this.app_btnOk.on("touchstart",this.endEvent);this.app_btnCancel.on("touchstart",this.endEvent)};m.prototype.endEvent=function(n){n.preventDefault();n.stopPropagation()};m.prototype._complete=function(o){var n;if(this.opts.data){var q=this.getCurrChangeElm(this.app_y_con);var r=this.getCurrChangeElm(this.app_m_con);var p=this.getCurrChangeElm(this.app_d_con);n=[q.text(),r.text(),p.text()];this.changeElement=[q[0],r[0],p[0]]}else{n=[];n.push(this.getYear());n.push(this.getMonth());n.push(this.getDate())}this.currDate=n;this.setCurrentTXT(n);this._hide();this.complete.call(this,o)};m.prototype._cancel=function(n){this._hide()};m.prototype._hide=function(){this.appWrap.css("display","none")};m.prototype.dateFm=function(o){return(o<10)?"0"+o:o};k.APPDateField=m;var f=function(p,n,o,q){this.elm=p;this.elmParent=n;this.hasTouch="ontouchstart" in window||window.TouchEvent;this.isTouchStart=false;this.options=o;this.callTarget=q;this.vlist={year:this.options.year,month:this.options.month,date:this.options.date,hours:this.options.hours,minutes:this.options.minutes,seconds:this.options.seconds};this.dy=0;this.h=$(this.elm).height();this.moveY=0;this.top=$(this.elm).position().top;this.step=b.step;this.fontSize=this.callTarget.opts.fontSize;this.offset={left:this.elmParent.offsetLeft,top:this.elmParent.offsetTop,width:$(this.elmParent).width(),height:$(this.elmParent).height()};this.startTime=0;this._initEvent(p)};f.prototype={_initEvent:function(n){if(this.hasTouch){n.addEventListener("touchstart",this,false);n.addEventListener("touchmove",this,false);n.addEventListener("touchend",this,false)}else{n.addEventListener("mousedown",this,false);n.addEventListener("mousemove",this,false);n.addEventListener("mouseup",this,false)}},handleEvent:function(n){switch(n.type){case"touchstart":this._start(n.targetTouches[0],n);break;case"touchmove":this._move(n.changedTouches[0],n);break;case"touchend":this._end(n.changedTouches[0],n);break;case"mousedown":this._start(n);break;case"mousemove":this._move(n);break;case"mouseup":this._end(n);break}if(/SELECT|TEXTAREA|INPUT/.test(n.target.tagName.toUpperCase())){n.preventDefault()}n.preventDefault();n.stopPropagation()},_start:function(n){this.isTouchStart=true;this.y=this.top=$(this.elm).position().top;this.h=$(this.elm).height();this.moveY=n.pageY;this.startTime=Date.now()},_move:function(n){if(this.isTouchStart){var p=$(n.target).parent("ul");p.find("li").css("fontSize",this.fontSize+"px");this.dy=this.y-(this.moveY-n.pageY);var o=this._formateTop(this.dy);this._scrollTop(p[0],o,true);(this.callTarget.opts.isCircle===true)&&a(p,o,this.callTarget)}},_end:function(n){this.isTouchStart=false;var q=$(n.target).parent("ul");var r=n.pageY-this.moveY;var o=this.y+r;var p=this._formateTop(o);this._scrollTop(q[0],p,false);(this.callTarget.opts.isCircle===true)&&a(q,p,this.callTarget)},_formateTop:function(n){if(n>=(b.step*3)){n=(b.step*3)}else{if(Math.abs(n)>=this.h-(b.step*4)){n=-(this.h-(b.step*4))}else{return n}}this.y=n;return n},_scrollTop:function(o,p,n){i(o,p,n,this,!this.callTarget.opts.showTime)}};function c(q,p){var n=[];for(var o=2;o<arguments.length;o++){n.push(arguments[o])}return function(r){n.push(r);p.call(q,r,n)}}function i(p,u,n,r,t){if(!p){return false}u=u||0;var q=b.step,s=r instanceof f;if(n){p.style.top=u+"px";t&&j(p,r)}else{$(p).off().animate({top:u},10,function(){var v=u%q;if(v!==0){var w=q*Math.round(u/q)-(Math.abs(v)<q?0:q);$(this).animate({top:w},function(){t&&j(p,r);o()});r.y=w}else{o()}})}function o(){if(!s){return}r.callTarget.moveElment=r.elm;var v=r.callTarget.getCurrChangeElm($(p));r.callTarget.moveEnd.call(r.callTarget,v[0],p)}}function j(n,o){if(!o.isTouchStart&&!o.callTarget.opts.data){o.callTarget.opts.year=o.callTarget.getYear();o.callTarget.opts.month=o.callTarget.getMonth();if(!$(n).hasClass("app-s-date-con")){o.callTarget.createDate(false)}}}function a(o,u,t){var p=Math.round(u/b.step);var r=Math.round(o.height()/b.step);if(p>=r){p=r-1}else{if(p>=1&&p<=3){if(p==1){p=3-p}else{if(p==2){p=3-p}else{if(p==3){p=0}}}}else{if(p<=0){p=Math.abs(p)+3}}}var q=t.app_center_con.find("ul").filter(function(v){return $(this).css("display")!="none"}),s=q.length;$.each(o.find("li"),function(v,w){if(p-4>v||v>p+4){$(w).css("visibility","hidden")}else{$(w).attr("style","")}});n("up");n("down");function n(B){var x=0,A=4,D,C,z=t.opts.fontSize,w=0,G=5,E=0,y=10;for(;x<A;x++){C="up"===B?p-x:p+x;
    D=(o.find("li").eq(C))[0];if(!D){continue}if(s===3){D.style.cssText="font-size:"+z+"px; text-indent:"+w+"px; -webkit-transform: skewX("+E+"deg)";o.hasClass("app-s-year-con")&&F();o.hasClass("app-s-date-con")&&v()}else{D.style.fontSize=z+"px"}z-=4}function F(){w+=G;(B==="down")?(E+=y):(E-=y)}function v(){w-=G;(B==="down")?(E-=y):(E+=y)}}}}).call(this);